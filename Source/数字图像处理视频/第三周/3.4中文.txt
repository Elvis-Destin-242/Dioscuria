现在我们介绍直方图均衡化的一个简单拓展 它就是直方图匹配 我们列举一些例子 之前看到过 在直方图均衡化中 我们对任意直方图 任意像素分布 都尽可能与均匀分布的直方图匹配 但是设想我们有这样一个像素分布 就是我们之前看到的分布图 而有人告诉我们 这个是我们的匹配目标 我不需要做均衡化 我只要处理后的直方图尽可能与这个分布相近 匹配的思想与前面提到的均衡化一样 我们要找到一个映射 就写在这里 这正是我们之前所做的映射 这个映射可以让我们将这个分布转换到 与这个直方图尽量接近 本例中 是变成这个图 很快我会解释这个方法 我们将会获得这样的分布 这与目标分布非常相似 并不是完全一致 但是非常的相似 从前面的视频中可以知道 很多情况下我们没办法完全得到指定的直方图 在前一个视频中 目标是均衡直方图 但是我们可以得到很相近的结果 正如这个直方图 那么如何匹配呢？ 大家已经掌握了所有方法 现在我来举例说明 我们从现有图像的像素值分布开始 无论分布怎样 这就是给定的图像 我们知道怎样把它映射到均匀分布 现在 给定一个分布 我们也知道如何把这个目标分布 映射为一个均匀分布 因此 如果知道了怎样从这里映射到这里 和如何从这里映射到这里 如果反转这个过程 我们便能知道 整个过程 这是我们的目标 于是我们将一个像素值从这里映射到这里 也许你想问 当我们想获得这个分布时 这一像素值从何而来 而我们只需求逆映射 所以我们有了一个映射和我们的映射 而我们只要反转第二个映射 假设这个是像素值 这一像素的灰度值7 转换为这里的10 然后你想问 从这里 哪一个像素值转换到10 然后这个映射会告诉你 是15 那么我们就完成了 7 到 10 的转换 而 10 求逆得到15 所以我们得到了 7 到 15 的映射 这就是直方图匹配的方法 通过直方图均衡化 现在我们知道 如何匹配任意两个给定的分布 这里提醒一下 正如前一个视频了解的 这个映射不需要是一对一的 所以 可能这里有一个以上的不同像素值 映射到那边的同一个像素值 所以 从像素值7 假如映射到10 可能也有一个像素值15 从这里映射到10 可能像素值 20 也会映射到 10 我要将 7 映射到 15 还是 20呢？ 这需要我们决定 最常用的决策是 挑选最接近原始值的值 所以我们可以对图像中的像素值做最小的变换 但是我们也可以做其他决策 只要这些决策保持一致 并且保证 最后得到一个递增函数 记住我们并不想出现像素值翻转 我们再重复一遍 先进行两次直方图均衡化 并且对其中一次均衡化求逆 然后完成直方图匹配 我们来看一下匹配的效果 这里是一个具体例子 这里有一幅灰暗的图像 可以看到 直方图中大多是暗灰度值 所以我们也难以看到图像的细节 因为它的颜色太暗了 如果我们进行直方图均衡化 会得到一个太明亮的图像 如图所示 这正是我们通常寻找的 T(r) 映射 而这是新的直方图 我们可以从直方图和图像中看到 处理后的图像太亮了 所以我们并没有获得真正想要的图像 我们需要的是一幅更容易观察到不同区域的图像 还是这幅图像 如果有人告诉我们 这个分布可以改善图像 我们就可以做直方图匹配 然后再来一次 我们从原始分布得到均衡化分布 再从这个新的分布 我们进行均衡化 得到这个映射 反转这个映射 这就是反映射 然后我们可以通过两个步骤 先将原始直方图转换为这个均衡化直方图 然后将均衡化的直方图通过这个逆映射转换为新的像素值 于是我们得到了这个分布 得到了比这张更清晰的图像 这个新的图像便于我们观察其中的细节 所以我们通过两次直方图均衡化完成了直方图匹配 一次是直接均衡化 而另一次需要求逆 而再一次 如果这里出现了多个映射 我们需要决定用哪种映射 比如说可以选择最接近原始图像的像素值 真是一箭双雕 如果我们知道怎么做直方图均衡 也就知道了怎么做直方图匹配 当然 设计目标直方图也是一门艺术 这个取决于实际需求 让我们提出直方图均衡化 或者直方图匹配的最后一个问题 到目前为止 我们考虑的都是整幅图像 我们就看整幅图像 关注整体分布 并把这些像素分布匹配到新的分布 进行均衡化或者某一特定分布 我们也可以在局部作同样的操作 比如 我们对这幅图像 做全局直方图均衡化 将得到这一图像 有时候它已经看起来好多了 但是效果不甚完美 在整幅图像中 我只有256个像素值来分布 我可能无法同时在这里和这里都得到较高的对比度 所以 解决这个问题的方法是 考虑不同区域 比如 我们只对这个区域做直方图均衡 并且对这个区域也进行直方图均衡化 它们可以是重叠的 我们会对每个区域进行单独处理 也许通过这个方法 当图像中有很大的灰度变化时 正如这个特殊图像 我们也可以提高图像中每个区域的对比度 这就是处理结果 比如说 注意这个区域 这里确实难以看到细节 这里也没有改善很多 但是这里看起来好多了 现在看这个区域 这里看不到很多细节 全局直方图均衡化确实有效 但这个区域没有多少改善 全局直方图均衡或者全局直方图匹配是一种折中方案 它们对图像的整体进行调节 我们可以通过局部操作 尝试克服 至少是部分克服这种折中处理的不足 现在我们可以看到 这里有明显的细节 这个区域也有明显细节 所以在图像的不同区域 它们有不同的像素值 我们仍然可以进行直方图拉伸 在不同的区域都得到更好的对比度 至此 我们结束了本单元对直方图均衡 和直方图匹配的学习 这是非常简单而有效的操作 下次视频见 谢谢 // 果壳教育无边界字幕组 | leafsherry | 风过成伤 | zeadoit