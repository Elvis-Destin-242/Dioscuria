【未完成版本】大家好 欢迎回来 我们刚刚学习过了曲线演化 还有一个知识点我们刚刚略过了是需要学习的 那就是我们如何在计算机上实现曲线演化 我们已经知道曲线演化是很重要的 例如使用配合曲率运动来调控曲线 在主动轮廓中则有更重要的作用 我们也需要学习 如何用一种友好的形式将其实现出来 因为在计算机中只有离散图像 所以我们将会谈谈它的数值实现 当我们讲解偏微分方程在图像处理中的应用时 有一个对于图像处理有着极大影响的领域 也就是水平集方法 我们来谈谈这个方法 有了这个方法 我们将会知道 如何将任意曲线曲面演化在计算机中实现出来 那么水平集的理论和框架是什么呢？ 我们来讨论一下曲线的情况 因为曲线的情况相对曲面来讲简单许多 不过曲面情况的原理是差不多的 我们已经谈过曲线以及曲线的表示 这里我们可以看到 这是一条已经参数方程化的曲线 对于每一个 p 都对应着曲线上不同的点 不过现在这不是唯一能表示曲线的方法了 还有一种非常不同的方法可以表示完全相同的一条曲线 实际上当我们讨论形状的时候我们会更熟悉它 它的基本原理 并不参数方程化曲线 而是将曲线表达为 平面上所有使得特定方程等于 0 的点 让我们来看看这张图片 我们在这里放下一个坐标系 x 和 y 然后我们说 所有在曲线上的点都使得函数 phi 在这个点的值为 0 那么我们得描述这个函数 phi 例如 我们可以定义 内部的点使得函数的值为正 外部的点则使得函数的值为负 比如我们可以定义这是到曲线的距离 显然曲线到自身的距离为 0 因为一个点到自己的距离为 0 所以 所有在曲线上的点到曲线的距离都是 0 所有内部的点都有着大于 0 的距离 并且我们定义外部的点有着小于 0 距离 用这种方式 我们可以定义函数 phi 这个零集合被叫做这个函数的零水平集 表示使得这个函数值为 0 的所有平面上的点定义的一条曲线 让我们来看看这里的这个剖面 如果我们有一个函数是里面是正的外面是负的 我用一条直线剖开它 那就可以得到一个剖面 函数从负值变化到正值 所以这个区域都是正的 接下来又到了外面 所以又变成了负值 之后又进入到内部 然后又到了外部 那么 哪些点是在曲线上的呢？ 这个点 它是 0 这个点 这个点 还有这个点 剖面的 phi 函数每一次经过 0 线的时候 对应的那个点就是在曲面上的 这样 啊 不好意思 应该是在曲线上 当然如果在更高维度下这就是曲面了 这样 我们就用这种使得某个函数的值为 0 的形式 定义了平面上的曲线 这只是两种对同一条曲线的不同表达 这就好像在曲线内部涂色 和在曲线外部涂色 而在曲线上涂的就是等于 0 现在有了这种表示方法 我们还得计算切线、法线和曲率 我们需要用这种表达来计算它们 否则我们没法做曲线演化 让我们来学习这些内容 我们需要先证明一些东西 就像我之前提过的 这周的课程是最理论化的一周了 不过我们要讲的都是自含的 那么我来讲讲里面发生的事情 我觉得我们学了挺多的新概念了 那我们就开始讲解这个 当然如前所述 曲线是由函数 phi 的水平集来定义的 法线实际上就是 phi 的梯度除以幅度 当然还要加上负号 这是一个惯例 因为我们需要法线是朝里面的 这只是个惯例 接下来切线自然就是这个了 这是一个垂直向量 让我们来证明这个 这证明起来并不困难 首先 我们有函数 phi 并且所有在曲线上的点都会使得 phi 的值为 0 所以沿着曲线的话 phi 的值是不会变化的 它总是 0 如果我沿着曲线走 总会得到 0 那么 函数的导数就是沿着曲线的 沿着弧长 因为我们是沿着函数值为 0 的曲线走 我们来算一下导数 我希望计算这个函数的导数 请记住 这个函数是存在于整个平面上的 我将要求沿着曲线弧长的方向的导数 那这个就是了 这是链式法则 基础微积分 如果我要求对 s 的导数 那这个导数就是先对 x 求导数 然后 x 再对 s 求导数 y 是一样的 这是一个简单的微积分 接下来 我这里写的是内积 内积是对两个向量的操作 如果大家不太记得的话 我把这个写下来 如果我要把向量两个向量乘起来 这是a、b 我实际上是要求内积 那么假如跟c、d相乘 那么就是 a * c + b * d 就是这样 现在这是 phi 的梯度和切线的内积 xs 和 ys 是切线 是单位切线 我们之前在谈平面微分几何曲线的时候 已经见过这个了 phi x 和 phi y 只是梯度 这就是为何我们得到了这个 那么这个是 0 从这里可以看到 当然这个也是 0 我们从这里到这里 当然 我还可以对它归一化 这样我就证明了 曲线的梯度是垂直于切线的 然后我们对梯度归一化 如果我有一个跟别的向量垂直的向量 显然 任何对这个向量进行幅长的变化不会影响垂直的关系 特别地 我想要把它 归一化成单位向量 这个仍然是等于 0 的 如果这个跟切线垂直 那它自然也就是法线了 我们这里是垂直的 所以它就是法线 再一次地 按照惯例加上一个负号 如果我们区分正负 我们希望这个梯度指向 我们希望这个法线指向内部 这是个惯例 这样我们就用一个简单的证明展示了这个 这就是法线的定义 如果我们有了 phi 毫无疑问我们就可以算出法线 当然我们也可以计算出切线 因为切线跟法线相互垂直 我们有了这个 啊两个 法线和切线 现在让我们来计算曲率 这也是一个很简单的计算 就像刚刚的那些一样 最多就多两三步 我们就能算出曲率 我们这里要求的是曲率 我们现在只有 phi 函数 曲率是对 s 的二阶导数 所以曲率就是 这里 Css 等于 K N 这就是曲率 这个是我需要计算的 但是我没有C 我们只有 phi 函数 我们有 C 也就是曲线 也就是隐含在函数 phi 里的零水平集 我想要证明这就是其对应的公式 有些同学可能不知道 div 是什么 div 就是散度 一个向量 alpha beta的散度 其实就是alpha x + beta y 所以这是一个标量 对于向量中的第一维 我们用它对 x 方向求导数 对于第二维 我们把它对 y 求导数 好的 让我们来证明这个公式是对的 因为我们还是沿着零水平集 所以我们仍然有这个关系 我们可以利用这个关系 我们要对 phi 求沿着曲线弧长的二阶导数 为了计算法线 我们已经在前一页演示稿里求出了一阶导数 现在我们要计算二阶导数 所以我们只需要对一阶导数再求一次导数 这部分其实就是 梯度和 T 的内积 我们之前已经见过了 我们现在要对这个求导数 内积的导数实际上就是 第一个分量的导数乘以第二个分量 再加上第一个分量乘以第二个分量的导数 那切线的导数是什么呢？ 二阶导数是在法线方向上的曲率 那这里也就是在法线方向上的曲率 再来一次 第一个分量与切线的内积 和第一个分量与第二个分量的导数的内积 第二个分量实际上就是 T 我们还知道 T 的导数是 kN 并且因为这个是等于 0 的 所以我们这里其实也是等于 0 的 那么就变成了 这一项的等于这一项 我把这个写在下面了 我们可以把曲率提出来 这没有任何问题 因为它是一个标量 我们可以把它从内积中提出来 这是我们要做的第一件事 噢 不好意思 这里有个笔误 这个应该是 phi 应该是一个大写的 phi 不好意思打错了 我们继续 很容易看出来 这一步有个笔误 我们把曲率提取出来了 把它放在这里 然后这个对应这个 我们在前一页见过 法线是梯度除以梯度(的模) 那么我们就得到了曲率 现在这个积实际上是梯度的平方 因为我们这里让它乘上了自己 所以这是梯度的平方除以梯度(的模) 其中一个梯度被抵消了 我们就剩下一个梯度(的模) 所以这一项就是这个 我没有把这一项写下来 但是现在同学们已经是专家啦 因为我们只要求导数和链式法则就可以了 如果我们要求梯度对 s 的导数 我们只要求它对 x 的导数然后 xs 加上对 y 的导数 以及 ys 【未完成版本】我们只要再做一遍链式法则 然后就可以得到这个表达式 这个表达式其实就是它的导数 然后切线我们之前已经得到过了 我们有了这个等式之后 把这个按定义展开 我们就会看到它跟这个式子是一样的 还要乘以这部分 我们这样就从 曲线的隐式方程得到了曲率的公式 请注意这个非常非常重要 讲到水平集上的曲线形成的时候 这就非常重要了 我并不需要知道曲线 我也不知道C C是一个隐式的定义 我需要知道的是 phi 函数 然后我们对 x 方向求导数 对 y 方向求导数 我们知道这些方法 那么这是 x 方向 这是 y 方向 就如我们在这门课里已经见过很多次那样 我们就求导数就可以了 这个像素减去这个像素 或者 用这个像素减去这个像素 如果要求 y 方向上导数 我们已经做过很多次了 直接套公式我们就可以得到曲率 或者得到法线或者得到切线 这真的很简单 我都不用沿着曲线求导 我们对这些格子求导 实际上是对图像求导 非常非常简单 现在我们已经知道了曲率 知道了法线 我们知道如何使曲线变形吗？ 让我们来看看这个 我们下一步要学习的是 如何使曲线变形 如何使得 phi 变化到 我们希望的一个边界上去 我们已经有了一个表达曲线的隐函数 我们知道曲线是用这种方式定义的 它随着速率而变化 我们得问问自己 我们如何根据这个速率来改变 phi 进而改变 phi 的水平集呢？ 结果就是这个形式 我们用几行就可以证明这个 在那之前 我们需要注意这里发生了什么 phi 是定义在整个图像上的 它遍布于整个格子上 我每次说求导的时候 我实际上在说对栅格求导数 所以像素实际上是上下移动 这样曲线就没有导数 导致非常难以实现 这就像 我们知道 我们已经知道如何计算梯度 同样这里得加一个负号 我们知道这些东西 所以比起这个 要实现这些会更简单 让我们来证明这个公式 其基本原理还是很简单 我需要求 phi 对 t 的导数 这是我要用的 我们把这边对 t 求导 然后把这边也对 t 求导 这边是 0 是一个常量 所以这边的导数还是 0 就是这个 这部分的导数 我将其写在这里 再用一次链式法则 这个关于 x y t 的函数的对 t 求导数 就得到这里的这个式子 我们先对 x 求导 然后得到 xt 加上 对 y 的导数 乘以 yt 加上对t的导数 这些都是偏导数 于是我们就有了这个 我们把这个移到另一边 因为这边是 0 所以我们得到了 负的这个对 t 的导数 然后等于右边的项 所以这一部分等于这部分的相反数 这部分我们之前已经见到过 这是一个内积 我们在之前的幻灯片中已经至少见过两次 这是 phi 的梯度 因为这一项和这一项 这个 xt 和 yt 就是 ct 也就是曲线变形 所以我们得到了这个 我们还得继续做一步 对于 ct 我们知道它是啥 就是 VN 所以我们写下VN 这就是我们想要的曲线的运动 我们可以把 V 提出来因为它也是个标量 然后我们就有了这个 现在我们想要把所有的东西都写成关于 phi 的函数 这部分很重要 我们把法线看作梯度的归一化 那么 我们这里就直接用这个结论 我们可以把 负的法线用 phi 的梯度来替换 并且将其归一化 跟之前一样 这里是梯度乘以梯度 所以这就是梯度的平方 然后除以一个梯度 我们就得到了一个梯度(的模) 这些是梯度 这些不变 我们就得到了这个 因为这里有个负号 于是就跟这里的负号抵消了 所以我们得到了这部分等于这部分 然后就得到了我们想要证明的结论 大家可以仔细看看 如果大家想自己验证一下 现在可以暂停一下视频来看看这个证明 这里只是用了一下链式法则 并且把所有的东西都写成是 phi 的函数 这部分挺重要的 当我们想要根据V在法线方向上 移动曲线的时候就需要这个 这是由把 phi 上下移动得到的 不论公式表达了什么 然后我们取剖面 如果我们想要得到 t 等于 5 的情形 那就让 t 等于 5 找到零水平集 然后我们就得到了曲线演化 现在所有的东西都是隐式的 我们有这些定义在全平面的函数 通过移动这些函数 我们移动了零水平集 然后我们就得到了曲线演化 例如 我们可以得到主动轮廓 为什么这个很重要呢 让我们来看一些思想 我觉得这些会帮助我们了解为何这个很重要 回想一下 有时候我们把一个曲线变形的时候 其拓扑也会发生变化 现在我来问问大家 哪一种曲线运动会导致拓扑变化 会导致拓扑上的变化 是曲率运动？ 仿射运动？还是法线运动？ 我们知道其实是法线运动 法线运动可以改变拓扑 如果曲线的拓扑发生了变化 如果我们对曲线离散化 这就很难理解 这个点和这个点相邻 最终这个点变化到了这里 这个点变化到了这里 于是它们就不再相邻 它们之前还是相邻的 但是因为拓扑变化了 它们就不再相邻了 这时候数值分析会变得非常复杂 比如当相邻事件变成不相邻事件 非常非常复杂 现在我们有了这个 phi 函数 想象一下这些灰色的是 phi 函数 这两个绿色的平面 浅绿色的和深绿色的 就是在不同的时间切割 phi 函数 phi 函数根据 V 和 phi 的梯度运动 我们要做的就是不断地切割 然后对拓扑的变化感兴趣 我们并不需要担心连通性 完全不用担心 因为我们是在栅格上操作 如这里所示 我们并不操作粒子和离散曲线 也不用记住谁跟谁相邻 以及拓扑变化的时候相邻关系如何变化 我们完全不用做这些 我们只需要对定义在栅格上的 phi 函数进行操作 就像我们这里这样 这只是另一个轮廓 phi 函数在变化 phi t 也就是 V 乘以 phi的梯度 就这样 我们把这个离散化 就像我们之前离散化那样 它会上下移动 例如 我们想知道现在的 曲线演化的状态 我们直接切过去就可以了 然后我们在整个平面上寻找那些使得当前 phi 函数值为 0 的位置 我们探查每一个坐标 或者这里的每一个坐标 不管有没有拓扑变化 我们能够知道 这就是这个方法的漂亮之处 这就是我们在前一个视频 的最后提到的活跃轮廓是如何用这个实现的 其中V是主动轮廓的速率 所以V可以写成简化形式 g 和曲率 g 则是图像的倒梯度 或者其他使其停止的函数 所以我们想要实现主动轮廓的话 要做的其实就是 phi t 等于 g 曲率 乘以梯度的模 我们从前一张幻灯片可以知道 曲率可以用关于 phi 的函数计算出来 所以所有的东西都是定义在栅格上的这个曲面的函数 这就是水平集的优雅之处 它极大地简化了数值计算 有了它我们就可以实现曲率运动 法线运动 法线运动十分简单 让我把它写下来 phi t 等于 phi 的梯度 那么我们可以用之前讲过的 同样的方法来离散化梯度 用右边的像素减去中间的像素 用上面的像素减去中间的像素 对于 phi t 则用 phi(t + 1) 减去 phi(t) 任何形式的时域离散化 我们不会讨论过多的数值分析 比如有些相对标准的数值分析方法 大家可以在实现更加高明的数值分析的时候直接使用 用一些相对标准的方法来替代对整个曲线离散化 一些很简单的等式 就是做我们想要的很复杂的曲线演化和曲线运动 我只对曲线的情况做了证明 但是对于曲面来说是一样的 事实上曲面的公式跟这些公式完全一样 但是 phi 并非在更高的维度里 所以公式完全一样 现在我们有了做主动轮廓的工具了 在这周的接下来的视频里 我们将会看到更多的主动轮廓 但是我们已经知道了曲线演化 以及如何实现曲线演化 我们学了很多的新东西 大家可以倒回去再看看视频 这些证明都是些很短的证明 其中只涉及了很简单的微积分和代数 大家不用关心这个 我只是在这个视频和前一个视频里稍微解释一下 那让我们继续前进 希望能在下一个视频里继续看到大家 谢谢大家 【未完成版本】